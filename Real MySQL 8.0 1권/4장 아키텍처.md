## 4.1 MySQL 엔진 아키텍처
- MySQL 서버는 엔진(머리)과 스토리지 엔진(손발)으로 구분
- MySQL 엔진은 커넥션 핸들러와 SQL 파서 및 전처리기, 옵티마이저가 중심
- 디스크 스토리지에 저장하거나 읽어오븐 부분은 스토리지 엔진이 전담
- 글로벌 메모리 영역
	- 테이블 캐시
	- InnoDB 버퍼 풀
	- InnoDB 어댑티브 해시 인덱스
	- InnoDB 리두 로그 버퍼
- 로컬 메모리 영역 : 세션 메모리 영역
	- 정렬 버퍼
	- 조인 버퍼
	- 바이너리 로그 캐시
	- 네트워크 버퍼
- 쿼리 실행 구조
	- 쿼리 파서 : 쿼리 문장을 토큰으로 분리해 트리 형태의 구조로 만들어 내는 작업
	- 전처리기 : 쿼리 문장에 구조적인 문제점이 있는지 확인
	- 옵티마이저 : 저렴한 비용으로 가장빠르게 처리할지 결정 하는 역할
- 쿼리 캐시는 MySQL 8.0 완전히 제거
- 메타데이터는 MySQL 8.0 버전부터 테이블에 저장하도록 개선

## 4.2 InnoDB 스토리지 엔진 아키텍처
- InnoDB는 프라이머리 키 값의 순서대로 디스크에 저장, 세컨더리 인덱스는 프라이머리 키의 값을 논리적인 주소를 사용
- MVCC는 레코드 레벨의 트랜잭션을 지원하는 기능이며, 가장 큰 목적은 잠금을 사용하지 않는 일관된 읽기를 제공하는 데 있다. (언두 로그를 이용)
- InnoDB 스토리지 엔진은 MVCC 기술을 이용해 잠금을 걸지 않고 읽기 작업을 수행
- InnoDB 버퍼 풀은 디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해 두는 공간이며 일괄 작업으로 처리할 수 있게 해주는 버퍼 역할도 같이 한다.
- 5.7 부터는 동적으로 버버풀의 크기를 조절 가능
- InnoDB 스토리지 엔진은 트랜잭션과 격리 수준을 보장하기 위해 DML로 변경되기 이전 버전의 데이터를 별도로 백업한다. 이렇게 백업된 데이터를 언두 로그라고 한다.
- 8.0 부터는 언두 로그를 돌아가면서 순차적으로 사용해 디스크 공간을 줄이는 것도 가능
- 언두 로그가 저장되는 공간을 언두 테이블스테이스라고 한다. 8.0 부터는 언두 로그는 외부의 별도 로그 파일에 기록되도록 개선
- InnoDB 인덱스 페이지가 디스크로부터 읽어와서 업데이트 해야한다면 임시 공간에 저장해 두고 바로 사용자에게 결과를 반환하는 형태로 성능을 향상시키는데 이때 사용하는 임시 메모리 공간을 체인지 버퍼라고 한다.
- 리두 로그는 영속성과 가장 밀접하게 연관되어 있으며, 서버가 비정상적으로 종료됐을 때 데이터 파일에 기록되지 못한 데이터를 잃지 않게 해주는 안전장치다.
- InnoDB 스토리지 엔진에서 사용자가 자주 요청하는 데이터에 대해 자동으로 생성하는 인덱스를 어댑티브 해시 인덱스라고 한다.
- 어댑티브 해시 인덱스는 비트리 검색 시간을 줄여주기 위해 도입된 기능

## 4.3 MyISAM 스토리지 엔진 아키텍처
- InnoDB의 버퍼 풀과 비슷한 역할을 하는 것이 키 캐시 이며, 인덱스만을 대상으로 작동한다.
- 디스크로부터의 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능도 MyISAM 스토리지 엔진은 가지고 있지 않다.
- MyISAM 테이블은 프라이머리 키에 의한 클러스터링 없이 데이터 파일이 힙공간처럼 활용 된다.

## 4.4 MySQL 로그 파일
- 슬로우 쿼리 로그는 쿼리가 정상적으로 실행이 완료돼야 로그에 기록될 수 있다.