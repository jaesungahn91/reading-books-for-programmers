- 트랜잭션은 작업의 완정성을 보장해주는 것
- 잠금과 트랜잭션은 서로 비슷한 개념 같지만 사실 잠금은 동시성을 제어하기 위한 기능이고 트랜잭션은 데이터의 정합성을 보장하기 위한 기능
## 5.1 트랜잭션
- 트랜잭션 또한 DBMS의 커넥션과 동일하게 꼭 필요한 최소의 코드에만 적용하는 것이 좋다. 즉, 트랜잭션의 범위를 최소화

## 5.2 MySQL 엔진의 잠금
- MySQL에서 사용되는 잠금은 크게 스토리지 엔진 레벨과 MySQL 엔진 레벨로 나눌 수 있다.
- 글로벌 락
	- 가장 범위가 크다.
	- MySQL 8.0 버전부터는 Xtrabackup이나 Enterprise Backup과 같은 백업 툴들의 안정적인 실행을 위해 백업 락이 도입
- 테이블 락
	- 개별 테이블 단위로 설정되는 잠금
	- InnoDB에서는 DDL의 경우에만 여향을 미친다.
- 네임드 락
	- GET_LOCK() 함수를 이용해 임의의 문자열에 대해 잠금을 설정할 수 있다.
	- MySQL 8.0 부터는 중첩 사용 가능
- 메타데이터 락
	- 데이터베이스 객체의 이름이나 구조를 변경하는 경우에 획득하는 잠금

## 5.3 InnoDB 스토리지 엔진 잠금
- 스토리지 엔진 내부에서 레코드 기반의 잠금 방식을 탑재
- 훨씬 뛰어난 동시성 처리를 제공
- 레코드 락
	- 레코드 자체만을 잠그는 락
	- 인덱스의 레코드를 잠근다
- 갭 락
	- 레코드와 바로 인접한 레코드 사이의 간격만을 잠그는 것
- 넥스트 키 락
	- 레코드 락과 갭 락을 합쳐 놓은 형태의 잠금
- 자동 증가 락
	- AUTO_INCREMENT 락
- InnoDB의 잠금은 레코드를 잠그는 것이 아니라 인덱스를 잠그는 방식으로 처리된다. 즉, 변경해야 할 레코드를 찾기 위해 검색한 인덱스의 레코드를 모두 락을 걸어야 한다.

## 5.4 MySQL의 격리 수준
- 트랜잭션의 격리 수준이란 여러 트랜잭션이 동시에 처리될 때 특정 트랜잭션이 다른 트랜잭션에서 변경하거나 조회하는 데이터를 볼 수 있게 허용할지 말지를 결정하는 것
- READ UNCOMMITTED
	- 각 트랜잭션에서의 변경 내용이 COMMIT이나 ROLLBACK 여부에 상관없이 다른 트랜잭션에서 보인다.
	- 더티 리드 발생
- READ COMMITTED
	- 어떤 트랜잭션에서 데이터를 변경했더라도 COMMIT이 완료된 데이터만 다른 트랜잭션에서 조회할 수 있다.
	- NON-REPEATABLE READ 발생
- REPEATABLE READ
	- InnoDB 스토리지 엔진에서 기본으로 사용
	- MVCC를 통해 동일 트랜잭션 내에서는 동일한 결과를 보여줄 수 있게 보장
	- PHANTOM READ 발생(InnoDB 스토리지에서는 발생하지 않음)
- SERIALIZABLE
	- 한 트랜잭션에서 읽고 쓰는 레코드를 다른 트랜잭션에서는 절대 접근할 수 없다.