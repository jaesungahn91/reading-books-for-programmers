## 04-1전송 계층 개요: IP의 한계와 포트
- 전송계층은 신뢰할 수 있는 통신과 연결형 통신을 가능하게 하여 이러한 IP의 한계를 극복하고, 포트 번호를 통해 응용 계층의 애플리케이션 프로세스들을 식별하는 역할을 수행
### 신뢰할 수 없는 통신과 비연결형 통신
- IP의 한계라고 볼 수 있는 두 가지 중요한 특징에는 신뢰할 수 없는 프로토콜, 비연결형 프로토콜이라는 점이 있다.
- 신뢰할 수 없는 통신은 IP 프로토콜이 패킷이 수신지까지 제대로 전송되엇다는 보장을 하지 않는 특징
	- 최선형 전달이라고도 부른다.
- 비연결형 통신은 이름 그대로 송수신 호스트 간에 사전 연결 수립 작업을 거치지 않는 특징을 의미한다.
- 이러한 단점의 주요한 이유는 성능 때문을 고려하기 때문에 발생한다.
### IP의 한계를 보완하는 전송 계층
- 전송 계층은 연결형 통신을 가능하게 한다.
	- 연결형 프로토콜인 TCP를 사용
- 전송 계층은 신뢰성 있는 통신을 가능하게 한다.
	- TCP는 패킷이 수신지까지 올바른 순서대로 확실히 전달되는 것을 보장
	- 비교적 높은 성능을 위해 UDP 프로토콜도 사용 가능
		- UDP는 신뢰할 수 없는 통신, 비연결형 통신을 가능하게 하는 전송 계층의 프로토콜
### 응용 계층과의 연결 다리, 포트
- 포트 : 패킷에 특정 애플리케이션을 식별할 수 있는 정보
- 포트 번호를 통해 특정 애플리케이션을 식별
	- 포트 번호는 16비트로 표현 가능, 사용 가능한 포트의 수는 2^16(65536개)
	- 0번부터 1023번까지의 포트 번호는 '잘 알려진 포트'
	- 1024번 부터 49151번까지는 '등록된 포트'
	- 49152번 부터 65535번까지는 동적, 사설, 임시 포트라고 부른다.
### 포트 기반 NAT
- NAT란 IP 주소를 변환하는 기술이며, 사설 IP 주소와 공인 IP 주소를 변환하는 데 사용. 이때 사용 되는 것이 NAT 변환 테이블 이다.
- 오늘날 NAT 기술은 대부분 다수의 사설 IP 주소를 그보다 적은 수의 공인 IP 주소로 변환. 이때 포트를 활용
- 포트 기반의 NAT를 NAPT라 한다.

### 좀 더 알아보기
```
- 포트 포워딩 : 네트워크 내 특정 호스트에 IP 주소와 포트 번호를 미리 할당하고, 해당 IP 주소:포트 번호로써 해당 호스트에게 패킷을 전달하는 기능
- ICMP : 패킷의 전송 과정에 대한 피드백 메시지를 얻기 위해 사용하는 프로토콜, IP의 신뢰할 수 없는 전송 특성과 비연결형 전송 특성을 보완하기 위한 네트워크 계층의 프로토콜
```

## 04-2 TCP와 UDP
- TCP는 신뢰할 수 있는 통신을 위한 연결형 프로토콜
- UDP는 TCP보다 신뢰성은 떨어지지만 비교적 빠른 통신이 가능한 비연결형 프로토콜
### TCP 통신 단계와 세그먼트 구조
- TCP의 통신의 세 단계
	- 연결 수립 -> 데이터 송수신 -> 연결 종료
- MSS(Maximum Segment Size)는 TCP로 전송할 수 있는 최대 페이로드 크기. 헤더 크기는 제외
- 송신지 포트와 수신지 포트 : 송신지 또는 수신지 애플리케이션을 식별하는 포트 번호가 명시되는 필드
- 순서 번호 : 순서 번호가 명시되는 필드
- 확인 응답 번호 : 다음으로 수신하기를 기대하는 순서 번호가 명시되는 필드
- 제어 비트 : 세그먼트에 대한 부가 정보를 나타낸다.
- 윈도우 : 수신 윈도우의 크기가 명시(한 번에 수신하고자 하는 데이터의 양)

**제어 비트**
- 기본적으로 8비트로 구성
- ACK : 세그먼트의 승인을 나타내기 위한 비트
- SYN : 연결을 수립하기 위한 비트
- FIN : 연결을 종료하기 위한 비트

**순서 번호와 확인 응답 번호**
- 신뢰성을 보장하기 위해 사용되는 중요한 필드
- 순서 번호는 올바른 송수신 순서를 보장하기 위한 번호
- 초기 순서 번호는 무작위 값, 이후 순서 번호는 `초기 순서 번호 + 송신한 바이트 수`
- 확인 응답 번호는 수신자가 다음으로 받기를 기대하는 순서 번호 `수신한 순서 번호 + 1`

### TCP 연결 수립과 종료

**연결 수립**
- 세 개의 단계로 이루어진 쓰리 웨이 핸드셰이크 연결 수립 과정이 이루어진다.
- 액티브 오픈 -> 패시브 오픈

**연결 종료**
- 액티브 클로즈 -> 패시브 클로즈
### TCP 상태
- 연결형 통신과 신뢰할 수 있는 통신을 유지하기 위해 '상태'를 유지
- TCP는 상태를 유지하고 활용한다는 점에서 스테이트풀 프로토콜이라고 한다.

**연결이 수립되지 않은 상태**
- CLOSED : 아무런 연결이 없는 상태
- LISTEN : 일종의 연결 대기 상태

**연결 수립 상태**
- SYN-SENT : 연결 요청을 보낸 뒤 대기하는 상태
- SYN-RECEIVED : 패시브 오픈 호스트가 ACK 세그먼트를 기다리는 상태
- ESTABLISHED : 연결이 확립되었음을 나타내는 상태

**연결 종료 상태**
- FIN-WAIT-1 : FIN 세그먼트로서 연결 종료 요청을 보낸 액티브 ㅋ
- CLOSE-WAIT : 
- FIN-WAIT-2 : 
- LAST-ACK : 
- TIME-WAIT : 