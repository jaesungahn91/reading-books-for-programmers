## 1단계 문제 이해 및 설계 범위 확정
- 모바일 앱, 웹 둘 다 지원
- 시간 흐름 역순으로 피드 표시
- 최대 5000명의 친구
- 매일 천만 명이 방문하는 트래픽 규모
- 이미지나 비디오 등의 미디어 파일이 포함될 수 있다.

## 2단계 개략적 설계안 제시 및 동의 구하기
### 뉴스 피드 API
- 피드 발행 API : 새 스토리를 포스팅하기 위한 API
- 피드 읽기 API : 뉴스 피드를 가져오는 API

### 피드 발행
 - 사용자 : 새 포스팅을 올리는 주체
 - 로드밸런서 : 트래픽을 웹 서버들로 분산
 - 웹 서버 : HTTP 요청을 내부 서비스로 중계
 - 포스팅 저장 서비스 : 새 포스팅을 데이터베이스와 캐시에 저장
 - 포스팅 전송 서비스 : 새 포스팅을 친구의 뉴스 피드에 푸시
 - 알림 서비스 : 친구들에게 새 포스팅이 올라왔음을 알림

### 뉴스 피드 생성
- 뉴스 피드 서비스 : 캐시에서 뉴스 피드를 가져오는 서비스
- 뉴스 피드 캐시 : 뉴스 피드를 렌더링할 때 필요한 ID를 보관

## 3단계 상세 설계
### 피드 발행 흐름 상세 설계
- 웹 서버
	- 웹 서버는 클라이언트와 통신할 뿐 아니라 인증이나 처리율 제한 등의 기능도 수행
- 포스팅 전송(팬아웃) 서비스
	- 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정
	- 팬아웃에는 두 가지 모델이 있다.
		- 쓰기 시점에 팬아웃하는 모델, 푸시 모델
		- 읽기 시점에 팬아웃하는 모델, 풀 모델
- 팬아웃 서비스의 동작
	1. 그래프 데이터베이스에서 친구 ID 목록 조회
	2. 사용자 정보 캐시에서 친구들의 정보를 가져온 후, 사용자 설정에 따라 일부를 걸러낸다.
	3. 친구 목록과 새 스토리의 포스팅 ID를 메시지 큐에 넣는다.
	4. 팬아웃 작업 서버가 메시지 큐에서 데이터를 꺼내어 뉴스 피드 데이터를 뉴스 피드 캐시에 넣는다.

### 피드 읽기 흐름 상세 설계
1. 사용자가 뉴스 피드를 읽으려는 요청을 보낸다.
2. 로드밸러서가 요청을 웹 서버로 전송
3. 노스 피드 서비스 호출
4. 포스팅 ID 목록 조회
5. 뉴스 피드 조합
6. 뉴스 피드 응답

### 캐시 구조
- 뉴스 피드 : 뉴스 피드의 ID 보관
- 콘텐츠 : 포스팅 데이터 보관
- 소셜 그래프 : 사용자 간 관계 정보 보관
- 행동 : 포스팅에 대한 사용자의 행위에 관한 정보 보관
- 횟수 : 좋아요, 응답, 팔로워 등 의 정보 보관