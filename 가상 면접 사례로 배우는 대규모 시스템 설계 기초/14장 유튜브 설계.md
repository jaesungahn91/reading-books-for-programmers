## 1단계 문제 이해 및 설계 범위 확정
- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 기능
- 낮은 인프라 비용
- 높은 가용성과 규모 확장성, 그리고 안정성
- 지원 클라이언트 : 모바일 앱, 웹브라우저, 스마트 TV

### 개략적 규모 추정
- DAU 5백만
- 한 사용자는 하루에 평균 5개의 비디오 시청
- 10%의 사용자가 하루에 1비디오 업로드
- 비디오 평균 크기는 300MB
- 비디오 저장을 위해 매일 새로 요구되는 저장 용량 150TB
- CDN 비용 매일 $150,000

## 2단계 개략적 설계안 제시 및 동의 구하기
- 시스템 설계 면접은 모든 것을 밑바닥부터 만드는 것과는 관계가 없다.
- 규모 확장이 쉬운 BLOB 저장소나 CDN을 만드는 것은 지극히 복잡할 뿐아니라 많은 비용이 드는 일
- 핵심 세 개 컴포넌트
	- 단말
	- CDN
	- API 서버

### 비디오 업로드 절차
- 원본 저장소 : 원본 비디오를 보관할 대형 이진 파일 저장소
- 트랜스코딩 서버 : 비디오 인코딩이라 부르기도 하는 절차
- 트랜스코딩 비디오 저장소 : 트랜스코딩이 완료된 비디오를 저장하는 BLOB 저장소
- CDN : 비디오를 캐시하는 역할 담당, 비디오 스트리밍
- 트랜스코딩 완료 큐 : 완료 이벤트를 보관
- 트랜스코딩 완료 핸들러 : 메타데이터 캐시와 데이터베이스를 갱신할 작업

### 비디오 스트리밍 절차
- 스트리밍 프로토콜은 비디오 스트리밍을 위해 데이터를 전송할 때 쓰이는 표준화된 통신방법
- 프로토콜마다 지원하는 비디오 인코딩이 다르고 플레이어도 다르다. 비디오 스트리밍 서비스를 설계할 때는 서비스의 용례에 맞는 프로토콜을 잘 골라야 한다.

## 3단계 상세 설계
### 비디오 트랜스 코딩
- 비트레이트는 비디오를 구성하는 비트가 얼마나 빨리 처리되어야 하는지를 나타내는 단위 = 화질
- 중요한 이유
	- 원본 비디오는 저장 공간을 많이 차지
	- 호환성 문제
	- 네트워크 대역폭에 따른 화질
- 인코딩 포멧 구성
	- 컨테이너 : 메타데이터
	- 코덱 : 압축 및 압축 해제 알고리즘

### 유향 비순환 그래프(DAG) 모델
- 각기 다른 유형의 비디오 프로세싱 파이프라인을 지원하는 한편 처리 과정의 병렬성을 높이기 위해서는 적절한 수준의 추상화를 도입하여 클라이언트 프로그래머로 하여금 실행할 작업을 손수 정의할 수 있도록 해야 한다.
- 비디오 적용 작업
	- 검사
	- 비디오 인코딩
	- 섬네일
	- 워터마크

### 비디오 트랜스 코딩 아키텍처
- 전처리기
	- 삐디오 분할
	- DAG 생성
	- 데이터 캐시
- DAG 스케줄러
	- DAG 그래프를 몇 개 단계로 분할한 다음에 각각을 자원 관리자의 작업 큐에 집어 넣는다.
- 자원 관리자
	- 자원 배분을 효과적으로 수행하는 역할
- 작업 실행 서버
	- DAG에 정의된 작업을 수행
- 임시 저장소
	- 비디오/오디오 데이터는 BLOB 저장소에 두는 것이 바람직

### 시스템 최적화
- 속도 최적화: 비디오 병렬 업로드
	- 비디오를 GOP 경계에 맞춰 분할하는 작업을 단말이 수행하면 업로드 속도를 높일 수 있다.
- 속도 최적화: 업로드 센터를 사용자 근거리에 지정
	- 업로드 센터를 여러 곳에 두는 것
- 속도 최적화: 모든 절차를 병렬화
	- 메시지 큐를 도입하여 시스템의 결합도 낮춤
- 안전성 최적화: 미리 사인된 업로드 URL
	- 허가받은 사용자만이 올바른 장소에 비디오를 업로드할 수 있도록 하기 위해 미리 사인된 업로드 URL을 이용
- 안전성 최적화: 비디오 보호
	- 디지털 저작권 관리
	- AES 암호화
	- 워터마크
- 비용 최적화
	- 인기 비디오는 CDN을 통해 재생, 일반 비디오는 서버를 통해 재생
	- 짧은 비디오는 필요할 때 인코딩하여 재생
	- 특정 지역별 비디오 관리
	- CDN을 직접 구축하고 인터넷 서비스 제공자와 제휴

## 4단계 마무리
- 추가 논의 사항
	- API 계층의 규모 확장성 확보 방안
	- 데이터베이스 계층의 규모 확장성 확보 방안
	- 라이브 스트리밍
	- 비디오 삭제