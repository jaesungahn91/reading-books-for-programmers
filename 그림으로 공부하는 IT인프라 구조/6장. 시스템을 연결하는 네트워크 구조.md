## 6.1 네트워크
- 네트워크 도식화가 어려운 이유
	- 네트워크 자체가 그 구조를 알지 못해도 사용할 수 있도록 돼 있기 때문
	- 블랙박스 부분이 많다.

## 6.2 계층 구조
- 컴퓨터 세계에서는 많은 부분에서 계층 구조(계층 모델)라는 개념을 적용
### 6.2.1 회사를 계층 구조에 비유
- 업무에 따라 부서가 나누는 것

### 6.2.2 계층 구조는 역할 분담
- 계층 구조에서는 역할이 나누어진다.
- 담당하는 일만 책임을 지며, 상호 연결돼 있는 계층들에서는 교환 방법, 즉 인터페이스만 정해 두면 된다.
- 계층간은 독립적으로 동작
- 단점으로는 작업 효율을 희생
	- 교대할 때 작업 인계를 위한 오버헤드가 발생

### 6.2.3 계층 모델의 대표적인 예 - OSI 7계층 모델
- 애플리케이션 계층 - 애플리케이션 처리
- 프레젠테이션 계층 - 데이터 표현 방법
- 세션 계층 - 통신 시작과 종료 순서
- 전송 계층 - 네트워크의 통신 관리
- 네트워크 계층 - 네트워크 통신 경로 선택
- 데이터 링크 계층 - 직접 접속돼 있는 기기 간 처리
- 물리 계층 - 전기적인 접속

### 6.2.4 계층 구조는 네트워크 외에도 존재
- 애플리케이션이나 OS, 하드웨어 조합도 계층 구조
- 계층은 레이어라고도 불린다.

## 6.3 프로토콜
### 6.3.1 사람끼리의 의사소통도 프로토콜
- 언어도 사람끼리의 통신을 위한 프로토콜
- 통신 시에 이용하는 매체도 프로토콜
	- 예를 들어 음성이라는 통신 프로토콜

### 6.3.2 컴퓨터에서는 프로토콜이 필수 불가결
- 프로토콜은 같은 계층 간의 약속
- 네트워크 업계에서는 공통 프로토콜 설정을 위한 IEEE나 IETF같은 표준화 단체가 존재

### 6.3.3 프로토콜은 서버 내부에도 존재
- 어떤 장비라도 서로 통신을 하기 위해서는 프로토콜이 필요
	- ex) USB - USB 프로토콜, 저장소 - SCSI 프로토콜, CPU - 코어들이 서로 통신을 하기 위한 프로토콜

## 6.4 TCP/IP를 이용하고 있는 현재의 네트워크
- 인터넷을 포함해서 현재 네트워크를 지탱하는 것은 TCP/IP 프로토콜 스위트(프로토콜 집합)이다.

### 6.4.1 인터넷의 발전과 TCP/IP 프로토콜
- 인터넷의 시초는 1969년에 미국 국방성 연구 - ARPANET(아프라넷)
	- 수십 kbps 정도의 통신 속도로 TCP나 IP 같은 프로토콜이 탄생하기 이전
- 이 시기에는 제조사별로 독자 프로토콜을 사용 -> 상호 접속에 문제 -> 국제 규격의 프로토콜 만듦(OSI)
- 최종적으로는 TCP/IP 프로토콜 스위트를 이용하는 네트워크가 대다수

### 6.4.2 TCP/IP 계층 구조
- TCP/IP 4계층 모델
- OSI 7계층의 1~2계층을 모아서 링크 계층, 5~7계층을 모아서 애플리케이션 계층으로 취급하기도 함

**TCP/IP 4계층 모델과 시스템 대응 관계**
- HTTP는 애플리케이션 프로토콜 -> httpd 프로세스 사용
- 이더넷 계층까지는 OS커널이 담당
- 이너넷 프레임 생성 -> NIC에 전달 -> 최종 위치까지 전달
- 계층 구조로 나누어져 있어 통신하고 싶은 애플리케이션은 독자적으로 통신 구조를 만들 필요 없이 TCP/IP에게 위임 가능
- 각 계층을 담당하고 있는 것도 쉽게 변경 가능
	- TCP대신 UDP, 유선이 아닌 무선

**TCP/IP 각 계층의 명칭**
- 링크 계층, 즉 이더넷 계층을 레이어 2나 L2, IP계층을 레이어 3나 L3, 전송 계층(TCP 계층)을 레이어 4나 L4라고 부른다.
- L5, L6, L7을 모아서 애플리케이션 계층으로 취급

## 6.5 \[레이어 7] 애플리케이션 계층의 프로토콜 HTTP
### 6.5.1 HTTP의 처리 흐름
- 애플리케이션 계층 프로토콜은 자신이 통신을 하는 것이 아니라 통신 자체는 모두 OS, 즉, TCP/IP에 맡긴다.

### 6.5.2 요청과 응답의 구체적인 내용
- 헤더부분 : 부가 정보
- User-Agent : 브라우저 식별 정보(버전이나 IE등의 브라우저 이름)
- Cookie : 세션 식별자로 사용
- 요청은 명령으로 구성, 응답은 상태와 함께 전송

### 6.5.3 애플리케이션 프로토콜은 사용자 공간을 처리
- 애플리케이션 프로토콜은 기본적으로 애플리케이션 프로세스 내부에서 모두 구현

### 6.5.4 소켓 이하는 커널 공간에서 처리
- 커널에 의뢰 방법은 시스템 콜이다.
- 접속 대상 서버의 'IP 주소'와 'TCP 포트'의 두 가지 정보가 필요
- IP 주소 및 포트 번호 정보를 시스템 콜 경우로 커널에 전달 -> 가상 경로(버추얼 서킷)가 생성

## 6.6 \[레이어 4] 전송 계층 프로토콜 TCP
- TCP는 명칭 그대로 전송을 제어하는 프로토콜로 신뢰도가 높은 데이터 전송을 가능케 한다.

### 6.6.1 TCP의 역할
- 애플리케이션이 보낸 데이터를 그 형태 그대로 상대방에게 확실하게 전달하는 것
- 단, 가능한 한 주변에는 민폐를 끼치지 않는다.
- 상대 서버까지 전송하는 부분은 하위 계층인 IP에 모두 위임
- IP에는 데이터가 상대방에게 확실히 전달됐는지 확인하는 기능이나 도착한 순서를 확인하는 기능 등이 없다.
- TCP가 하는 몇가지 중요한 기능
	- 포트 번호를 이용해서 데이터 전송
	- 연결 생성
	- 데이터 보증과 재전송 제어
	- 흐름 제어와 폭주 제어

### 6.6.2 커널 공간의 TCP 처리 흐름
- TCP는 데이터를 세그먼트라고 하는 단위로 관리
- TCP 헤더를 붙여서 TCP 세그먼트를 작성
- TCP 세그먼트로 전송할 수 있는 최대 데이터 크기 :  MSS(Maximum Segment Size)
- 링크 계층에서 전송할 수 있는 최대 데이터 크기 :  MTU(MAximum Transfer Unit)

### 6.6.3 포트 번호를 이용한 데이터 전송
- TCP에서는 포트 번호를 사용해서 어떤 애플리케이션에 데이터를 전달할지 판단
- TCP 포트 번호는 0~65535까지의 숫자 이용

### 6.6.4 연결 생성
- TCP는 연결형 프로토콜로, 연결이라 불리는 가상 경로(버추얼 서킷)를 생성
- 서버 측 소켓은 자신이 지정한 포트 번호에 통신이 오는지를 기다렸다가 받는다.
	- 이 상태를 포트를 리슨(LISTEN)하고 있다고 한다.
- 가상 경로를 열도록 의뢰 -> 열어도 된다는 응답 -> 확인했다는 메시지 -> 통신용 가상 경로 생성
	- 이 세 번의 대화를 TCP/IP의 3-way handshaking이라고 한다.

### 6.6.5 데이터 보증과 재전송 제어
**데이터 손실을 방지하는 구조**
- 응답과 재전송에 의해 구현
- 도착했다는 ACK를 반환
- 전송이 끝난 TCP 세그먼트라도 ACK가 돌아오기까지는 소켓 버퍼에 담겨 둘 필요

**데이터 순서를 보증하는 구조**
- 시퀀스 번호라고 하는 숫자를 붙여서 구현
- TCP 헤더에 기록

**TCP 재전송 제어**
- ACK를 반환할 때 다음에 필요한 TCP 세그먼트 시퀀스 번호도 ACK 번호로 전달
- 일정 시간 내에 ACK가 돌아오지 않아 타임아웃되면 재전송
- 한번 받은 ACK 번호와 같은 것이 3회 중복돼서 도착한 경우 그 번호에 해당하는 TCP 세그먼트가 도착하지 않았다고 간주하고 재전송
- TCP에는 SACK(Selective ACK)라고 불리는 옵션도 존재
	- 더 상세한 ACK 반환 가능

### 6.6.6 흐름 제어와 폭주 제어
**흐름 제어**
- TCP는 어느 정도의 세그먼트 수라면 ACK를 기다리지 않고 전송 = 윈도우
	- ACK를 기다리지 않고 전송 가능한 데이터 크기 = 윈도우 크기
- 윈도우에는 수신측의 수신 윈도우와 송신 측의 폭주(송신) 윈도우 두 가지가 있다.
- 수신 윈도우 중 작은 쪽을 송신 윈도우로 채택
- 윈도우를 이동해 가는 방식 = 슬라이딩 윈도우
- 수신 측은 수신용 소켓버퍼가 넘쳐서 더 이상 수신이 불가능하게 되면 수신 윈도우 크기를 작게 만들고 알린다 -> 송신 측은 윈도우 크기 이상의 데이터는 ACK 없이 보낼 수 없게 된다.
	- => TCP 흐름 제어(유량 제어)

**폭주 제어**
- 송신 측 윈도우 크기는 네트워크 폭주 상태(혼잡 상태)에 맞추어 변경
- 네트워크가 혼잡하면 폭주 윈도우 크기를 작게 해서 전송 데이터 양을 줄인다.
	- => 폭주 제어
- ACK 반환 시마다 폭주 윈도우 크기를 지수 함수적으로 늘려나간다.
	- => 슬로우 스타트

## 6.7 \[레이어 3] 네트워크 계층의 프로토콜 IP
- IP의 역할 '지정한 대상 서버까지 전달받은 데이터를 전해 주는 것'
- 전달된다는 보장은 하지 않음
- IP 주소를 이용해서 최종 목적지에 데이터 전송
- 라우팅(Routing)

### 6.7.2 커널 공간의 IP 처리 흐름
- IP 계층에서는 최종 목적지가 적힌 IP 헤더를 TCP 세그먼트에 추가해서 IP 패킷을 생성
- 헤더에는 목적지 IP주소, 데이터 길이, 프로토콜 종류, 헤더 체크섬 등이 기록

### 6.7.3 IP 주소를 이용한 최종 목적지로의 데이터 전송
- IP에서는 최종 목적지 서버까지 복수의 네트워크를 경유해서 데이터를 전송
- IP 주소는 32비트로 표현된 숫자 집합
- IP 주소는 네트워크부와 호스트부로 나뉜다.
- 네트워크부 '어디의', '누구'인지
- 네트워크부인지 표시를 위해 '/24'와 같은 CIDR(사이더)표기 사용
	- 255.255.255.0과 같이 표혆