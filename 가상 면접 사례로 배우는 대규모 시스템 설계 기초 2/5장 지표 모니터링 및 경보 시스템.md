## 1단계: 문제 이해 및 설계 범위 확정
### 개략적 요구사항 및 가정
- 대규모 인프라를 모니터링 해야 함
	- 일간 능동 사용자 수 1억 명
	- 서버 풀 1,000개, 풀당 서버 수 100개. 서버당 100개의 운영 지표를 수집한다고 치면 모니터링 해야 하는 지표의 수는 천만 개 수준
	- 데이터 보관 기간은 1년
	- 수집한 그대로 데이터를 보관하는 기간은 일주일. 그 뒤에는 1분 단위 데이터로 변환한 후에 30일간 보관. 그 뒤에는 1시간 단위 데이터로 변환한 뒤에 1년간 보관.
- 모니터링할 지표는 다양한데, 예를 들면 다음과 같은 것이 있음
	- CPU 사용률
	- 요청 수
	- 메모리 사용량
	- 메시지 큐 내의 메시지 수
### 비기능 요구사항
- 규모 확장성: 시스템은 늘어나는 지표 수와 경보의 양에 맞게 확장될 수 있어야 한다.
- 낮은 응답 지연: 대시보드와 경보를 신속하게 처리할 수 있도록, 질의에 대한 낮은 응답 지연을 보장해야 한다.
- 안정성: 높은 잔성성을 제공하여 중요 경보를 놓치지 않도록 해야 한다.
- 유연성: 기술은 계속 변화하므로, 미래의 신기술을 쉽게 통합할 수 있도록 유연하게 변경 가능한 파이프라인을 이용해 구축한 시스템이어야 한다.
## 2단계: 개략적 설계안 제시 및 동의 구하기
### 기본적 사항
- 데이터 수집
- 데이터 전송
- 데이터 저장소
- 경보
- 시각화
### 데이터 모델
- 지표 데이터는 통상 시계열 데이터 형태로 기록
### 데이터 접근 패턴
- 쓰기 부하가 막대. 반면 읽기 부하는 일시적으로 치솟았다 사라지는 편
### 데이터 저장소 시스템
- 시장에서 인기있는 시계열 데이터베이스
	- InfluxDB
	- 프로메테우스
### 개략적 설계안
- 니표 출처
- 지표 수집기
- 시계열 데이터베이스
- 질의 서비스
- 경보 시스템
- 시각화 시스템
## 3단계: 상세 설계
### 지표 수집
- 지표를 보내는 클라이언트는 성공적으로 데이터가 전송되었는지 신경 쓰지 않아도 상관없다.(어느정도 데이터 소실 허용)
- 풀 모델
	- 서비스 목록 관리를 위한 서비스 탐색 기술 활용
	- 지표 수집기 서버 풀환경에서 지표 수집 서버 간에 모종의 중재 메커니즘 필요
		- 안정 해시 링활용 가능
	- 채택한 사례 : 프로메테우스
- 푸시 모델
	- 직접 지표를 수집기에 전송하는 모델
	- 수집 에이전트를 설치
	- 데이터 집계를 통해 데이터의 양을 줄이는 효과를 낼 수도 있음
	- 채택한 사례 : 아마존 클라우드와치, 그래파이트
- 지표 수집기는 지표 데이터를 카프카와 같은 큐 시스템에 전송
	- 아파치 스톰, 플링크, 스파크 등
- 소비자가 시계열 데이터베이스에 데이터 저장
- 큐 없이도 대규모 데이터가 처리가능한 모니터링 시스템도 있음
	- 시계열 데이터베이스 시스템 고릴라
### 질의 서비스
- 대부분의 사용 시각화 및 경보 시스템은 시장에서 널리 사용되는 시계열 데이터베이스와의 연동을 처리하는 강력한 플러그인을 이미 갖추고 있는 경우가 많다.
### 저장소 계층
- 시계열 데이터베이스는 신중하게 선택
	- 질의의 85%는 지난 26시간 내에 수집된 데이터를 대상으로 함
- 저장 용량 최적화
	- 데이터 인코딩 및 압축
		- ex) 1610087371, 10, 10, 9, 11
	- 다운 샘플링 : 데이터의 해상도를 낮춰 저장소 요구량을 줄이는 기법
- 냉동 저장소 : 비활성 상태 데이터를 보관하는 곳
### 경보 시스템
- 처리 흐름
	1. 설정파일을 가져와 캐시 서버에 보관
	2. 캐시에서 설정 내역 가져옴
	3. 질이 서비스 호출
	4. 알림이 적어도 한 번 이상 전달되도록 보장
	5. 경보 이벤트를 카프카에 전달
	6. 경보 소비자 이벤트 읽기
	7. 알림 전송
	- 바로 지원 가능한 경보 시스템은 시장에 많다. 유명 시계열 데이터베이스와 통합 지원
### 시각화 시스템
- 시각화 시스템은 구현하기 어렵다. 따라서 사용품을 구입해서 사용하는 것이 바람직
