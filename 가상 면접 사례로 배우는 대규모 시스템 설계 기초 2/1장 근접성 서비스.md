## 1단계: 문제 이해 및 설계 범위 확정
### 기능 요구사항
- 사용자의 위치와 검색 반경 정보에 매치되는 사업장 목록을 반환
- 사업장 소유주가 사업장 정보를 추가/삭제/갱신할 수 있도록 하되, 그 정보가 검색 결과에 실시간으로 반영될 필요는 없다고 가정
- 고객은 사업장의 상세 정보를 살필 수 있어야 함
### 비기능 요구사항
- 낮은 응답 지연
- 데이터 보호 : 사용자의 위치는 민간함 정보로 보호할 방법을 고려해야 한다.
- 고가용성 및 규모 확장성 요구사항
### 개략적 규모 추정
- 일간 능동 사용자(DAU)는 1억 명, 등록된 사업장 수는 2억
## 2단계: 개략적 설계안 제시 및 동의 구하기
### 개략적 설계
- 로드밸런서
- 위치 기반 서비스(LBS)
- 데이터베이스 클러스터
- 사업장 서비스와 LBS의 규모 확장성
### 주변 사업장 검색 알고리즘
- 지리적 정보에 색인을 만드는 방법은 크게 두 종류
	- 해시 기반 방안 : 균등 격자, 지오해시, 카르테시안 계층 등
	- 트리 기반 방안 : 쿼드트리, 구글 S2, R 트리 등
- 개략적 아이디어는 지도를 작은 영역으로 분할하고 고속 검색이 가능하도록 색인을 만드는 것으로 같다.
- 균등 격자
	- 작은 격자 또는 구획으로 나누는 단순한 접근법
	- 사업장 분포가 균등하지 않다는 단점
- 지오해시
	- 균등 격자보다 나은 방안
	- 2차원의 위도 경도 데이터를 1차원의 문자열로 반환
	- 통상적으로 base32 표현법을 사용
	- 아주 가까운 두 위치가 어떤 공통 접두어를 갖지 않는 일이나 두 지점이 공통 접두어 길이는 길지만 서로 다른 격자에 놓이는 경우 등 격자 가장자리 처리 방식에 관한 경계 조건이 있다. 해결책은 현재 격자를 비롯한 인접한 모든 격자의 모든 사업장 정보를 가져오는 것
- 쿼드트리
	- 격자의 내용이 특정 기준을 만족할 때까지 2차원 공간을 재귀적으로 사분면 분할 하는 데 흔히 사용되는 자료 구조
	- 서버를 시작하는 순간에 트리를 구축하면 서버 시작 시간이 길어질 수 있다.
	- 사업장이 추가/삭제되었을 때 쿼드트리를 갱신하는 문제
- 구글 S2
	- 쿼드트리와 마찬가지로, 이 해법도 메모리 기반.
	- 지구를 힐베르트 곡선이라는 공간 채움 곡선을 사용하여 1차원 색인화하는 방안
## 3단계: 상세 설계
### 데이터베이스의 규모 확장성
- 사업장 테이블
	- 샤딩을 적용
- 지리 정보 색인 테이블
	- 각각의 지오해시에 연결되는 모든 사업장 ID를 JSON 배열로 만들어 같은 열에 저장하는 방안
	- 같은 지오해시에 속한 사업장 ID 각각을 별도 열로 저장하는 방안. 이 방안은 사업장 정보를 추가하고 삭제하기가 쉽다.
- RDBS 부하 분산의 두 가지 전략
	- 읽기 연산을 지원할 사본 데이터베이스 서버를 늘리는 것.
	- 샤딩을 적용
- 지오해시 테이블은 샤딩이 까다롭다.
### 캐시
- 캐시 도입을 의논할 때는 벤치마킹과 비용 분석에 각별히 주의
- 캐시 데이터 유형
	- 지오해시 - 해당 격자 내의 사업장 ID 목록
	- 사업장 ID - 사업장 정보 객체
### 지역 및 가용성 구역
- 위치 기반 서비스는 여러 지역과 가용성 구역에 설치
	- 사용자와 시스템 사이의 물리적 거리를 최소한
	- 트래픽을 인구에 따라 고르게 분산하는 유연성 확보.
	- 지역의 사생활 보호법에 맞는 운영이 가능.